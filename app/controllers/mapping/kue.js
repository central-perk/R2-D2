// Generated by CoffeeScript 1.7.1
var aDataModels, jobs, kue, logger, utils;

kue = require('kue');

jobs = kue.createQueue();

utils = process.g.utils;

logger = utils.getCtrl('log');

aDataModels = _.keys(require('mongoose').models);

_.each(aDataModels, function(sDateModel) {
  return jobs.process(sDateModel, 1, function(job, done) {
    var oLog, sLogType;
    sLogType = job.data.type;
    oLog = job.data.log;
    return logger(sLogType, function(err, fWriteLog) {
      return fWriteLog(oLog, function(err) {
        if (!err) {
          return done();
        }
      });
    });
  });
});

module.exports = function(req) {
  var log, type;
  type = req.type;
  log = req.query;
  return jobs.create(type, {
    type: type,
    log: log
  }).attempts(3).save();
};
